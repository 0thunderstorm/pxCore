
all: rtNode
clean:
	rm -rf $(OBJDIR)
	rm -f rtNode

VPATH=linux

RT_SRCS=\
    rtError.cpp \
    rtObject.cpp \
    rtLog.cpp \
    rtString.cpp \
    rtValue.cpp \
    rtFile.cpp \
    rtThreadTask.cpp \
    rtLibrary.cpp \
    utf8.c

#PX_SRCS=\
#    pxContextGL.cpp \
#    pxImage.cpp \
#    pxImage9.cpp \
#    pxScene2d.cpp \
#    pxRectangle.cpp \
#    pxText.cpp \
#    pxText2.cpp \
#    pxUtil.cpp \
#    pxInterpolators.cpp \
#    pxFileDownloader.cpp \
#    pxTextureCacheObject.cpp \
#    pxMatrix4T.cpp \
#    pxTransform.cpp \
#    pxMain.cpp \
#    pxNode.cpp

EXTDIR=../external
PXCOREDIR=../../../
PXHDRS=$(PXCOREDIR)/src
PXLIBS=$(PXCOREDIR)/build/glut

NODEINC=../external/libnode
NODEDIR=../external/libnode

SEARCH=\
  -Ilinux \
  -I$(EXTDIR)/jpg \
  -I$(EXTDIR)/curl/include \
  -I$(EXTDIR)/ft/include \
  -I$(EXTDIR)/png \
  -I$(PXHDRS)\
  -I. \
  -I$(NODEINC)/src \
  -I$(NODEINC)/deps/uv/include \
  -I$(NODEINC)/deps/v8 \
  -I$(NODEINC)/deps/debugger-agent/include
 # -I$(NODEINC)/deps/v8/include


CXXFLAGS= -g $(SEARCH) -DENABLE_GLUT -DRT_PLATFORM_LINUX -DPX_PLATFORM_GLUT
#CXXFLAGS=-Wall -Wextra -g $(SEARCH) -DENABLE_GLUT -DRT_PLATFORM_LINUX -DPX_PLATFORM_GLUT


LDPNG    = -L$(EXTDIR)/png/.libs -lpng16
LDJPG    = -L$(EXTDIR)/jpg/.libs -ljpeg
LDFT     = -L$(EXTDIR)/ft/objs/.libs -lfreetype
LDCURL   = -L$(EXTDIR)/curl/lib/.libs -lcurl
LDNODE   = -L$(NODEDIR)/out/Release/obj.target
LDNODEV8 = -L$(NODEDIR)/out/Release

LDEXT   = $(LDPNG) $(LDJPG) $(LDFT) $(LDCURL) $(LDNODE) $(LDNODEV8)

LDFLAGS = -L$(PXLIBS) -lpxCore -pthread -lglut -lGLEW -lGL $(LDEXT) -ldl -lrt -lnode -lv8_libplatform


OBJDIR=obj

rtMutexNative.o: linux/rtMutexNative.cpp
	g++ -o $(OBJDIR)/rtMutexNative.o -Wall $(CXXFLAGS) -c linux/rtMutexNative.cpp

rtThreadPoolNative.o: linux/rtThreadPoolNative.cpp
	g++ -o $(OBJDIR)/rtThreadPoolNative.o -Wall $(CXXFLAGS) -c linux/rtThreadPoolNative.cpp

SRCS=rtNode.cpp $(RT_SRCS)

OBJS=$(patsubst %.cpp, $(OBJDIR)/%.o, $(notdir $(SRCS)))
OBJS:=$(patsubst %.c, $(OBJDIR)/%.o, $(OBJS))
OBJS: $(SRCS)

$(OBJDIR)/%.o : %.cpp
	@[ -d $(OBJDIR) ] || mkdir -p $(OBJDIR)
	$(CXX) -c $(CXXFLAGS) $< -o $@

$(OBJDIR)/%.o : %.c
	@[ -d $(OBJDIR) ] || mkdir -p $(OBJDIR)
	$(CC) -c $(CXXFLAGS) $< -o $@

MORE=\
#   jsCallback.o \
#   rtWrapperInit.o \
#   rtWrapperUtils.o \
#   rtFunctionWrapper.o \
#   rtObjectWrapper.o \
   rtMutexNative.o \
   rtThreadPoolNative.o

MOREDIR=\
#   $(OBJDIR)/jsCallback.o \
#   $(OBJDIR)/rtWrapperInit.o \
#   $(OBJDIR)/rtWrapperUtils.o \
#   $(OBJDIR)/rtFunctionWrapper.o \
#   $(OBJDIR)/rtObjectWrapper.o \
   $(OBJDIR)/rtMutexNative.o \
   $(OBJDIR)/rtThreadPoolNative.o


rtNode: $(MORE) $(OBJS)
	$(CXX) $(OBJS) $(MOREDIR) $(LDFLAGS) -o rtNode

